"use strict";(()=>{var l=Object.defineProperty;var u=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var h=(s,e,t)=>e in s?l(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,c=(s,e)=>{for(var t in e||={})m.call(e,t)&&h(s,t,e[t]);if(u)for(var t of u(e))b.call(e,t)&&h(s,t,e[t]);return s};var f=new Map,g=15*60*1e3,p=40;function y(){let s=document.querySelectorAll("a[href]"),e=new Set;return s.forEach(t=>{try{let r=t.getAttribute("href");if(!r)return;if(r.startsWith("http://")||r.startsWith("https://")){let o=new URL(r);e.add(o.hostname)}}catch(r){}}),Array.from(e)}function S(s){document.querySelectorAll("a[href]").forEach(t=>{try{let r=t.getAttribute("href");if(!r)return;if(r.startsWith("http://")||r.startsWith("https://")){let o=new URL(r),n=s[o.hostname];n!==void 0&&n<p&&t.classList.add("sp-danger")}}catch(r){}})}async function w(s){let e=Date.now(),t={},r=[];if(s.forEach(o=>{let n=f.get(o);n&&e-n.timestamp<g?t[o]=n.score:r.push(o)}),r.length===0)return t;try{let o=await chrome.runtime.sendMessage({action:"getScores",hosts:r});return Object.entries(o).forEach(([n,a])=>{f.set(n,{score:a,timestamp:e})}),c(c({},t),o)}catch(o){return console.warn("Scam-Protector: Failed to get scores",o),t}}async function i(){let s=y();if(s.length===0)return;let e=await w(s);S(e)}function T(s,e){let t=!1;return function(...r){t||(s.apply(this,r),t=!0,setTimeout(()=>{t=!1},e))}}function E(){let s=T(i,1e3);new MutationObserver(t=>{let r=!1;for(let o of t){if(o.type==="childList"||o.type==="attributes"){if(o.type==="attributes"&&o.attributeName==="href"){r=!0;break}if(o.addedNodes.length>0)for(let n=0;n<o.addedNodes.length;n++){let a=o.addedNodes[n];if(a.nodeType===Node.ELEMENT_NODE){let d=a;if(d.tagName==="A"||d.querySelector("a")){r=!0;break}}}}if(r)break}r&&("requestIdleCallback"in window?window.requestIdleCallback(()=>s()):setTimeout(()=>s(),100))}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["href"]})}document.addEventListener("DOMContentLoaded",()=>{i(),E()});window.addEventListener("load",()=>{setTimeout(i,1e3)});})();
