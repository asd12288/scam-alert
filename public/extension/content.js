"use strict";(()=>{var p=Object.defineProperty;var h=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var f=(o,t,e)=>t in o?p(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,d=(o,t)=>{for(var e in t||={})g.call(t,e)&&f(o,e,t[e]);if(h)for(var e of h(t))y.call(t,e)&&f(o,e,t[e]);return o};var l=new Map,b=15*60*1e3,w=60,m=30,i={largeText:!0,highContrast:!1,verboseWarnings:!0,animationReduced:!1};function S(){let o=document.querySelectorAll("a[href]"),t=new Set;return o.forEach(e=>{try{let s=e.getAttribute("href");if(!s)return;if(s.startsWith("http://")||s.startsWith("https://")){let n=new URL(s);t.add(n.hostname)}}catch(s){}}),Array.from(t)}function x(o){return i.verboseWarnings?o<m?"\u26A0\uFE0F WARNING: This website appears to be unsafe! High risk of scam or fraud. Avoid clicking.":"\u26A0\uFE0F CAUTION: This website has a low trust score and might be unsafe. Click with caution.":"\u26A0\uFE0F Potential scam: low trust score"}async function C(){try{l.clear(),await chrome.runtime.sendMessage({action:"getScores",clearCache:!0}),console.log("[Scam-Protector] Cache cleared successfully"),await c()}catch(o){console.error("[Scam-Protector] Failed to clear cache:",o)}}function T(){if(!(window.location.search.includes("sp-debug")||window.location.hostname==="localhost"||window.location.hostname.includes("test")))return;let t=document.createElement("div");t.style.position="fixed",t.style.bottom="10px",t.style.right="10px",t.style.padding="10px",t.style.background="rgba(0,0,0,0.8)",t.style.color="white",t.style.borderRadius="5px",t.style.zIndex="9999999",t.style.fontSize="12px",t.style.fontFamily="Arial, sans-serif";let e=document.createElement("button");e.textContent="Clear Score Cache",e.style.background="#ff3333",e.style.border="none",e.style.color="white",e.style.padding="5px 10px",e.style.borderRadius="3px",e.style.cursor="pointer",e.addEventListener("click",C);let s=document.createElement("button");s.textContent="Force Re-scan",s.style.background="#3333ff",s.style.border="none",s.style.color="white",s.style.padding="5px 10px",s.style.marginLeft="5px",s.style.borderRadius="3px",s.style.cursor="pointer",s.addEventListener("click",()=>c());let n=document.createElement("div");n.textContent="Scam-Protector debug mode",n.style.marginTop="5px",n.style.fontSize="10px",t.appendChild(e),t.appendChild(s),t.appendChild(n),document.body.appendChild(t)}function E(o){document.querySelectorAll("a[href]").forEach(e=>{try{let s=e.getAttribute("href");if(!s)return;if(s.startsWith("http://")||s.startsWith("https://")){let n=new URL(s),r=o[n.hostname];if(r!==void 0&&(console.debug(`Scam-Protector: ${n.hostname} has score ${r}`),r<w)){e.classList.add("sp-danger");let a=x(r);e.setAttribute("data-sp-warning",a),e.setAttribute("aria-description",a),r<m&&e.classList.add("sp-danger-badge"),i.largeText&&e.style.setProperty("--sp-warning-font-size","16px"),i.highContrast&&e.classList.add("sp-high-contrast"),i.animationReduced&&e.style.setProperty("--sp-animation","none")}}}catch(s){}})}async function v(o){let t=Date.now(),e={},s=[];if(o.forEach(n=>{let r=l.get(n);r&&t-r.timestamp<b?e[n]=r.score:s.push(n)}),s.length===0)return e;try{let n=await chrome.runtime.sendMessage({action:"getScores",hosts:s});return Object.entries(n).forEach(([r,a])=>{l.set(r,{score:a,timestamp:t})}),d(d({},e),n)}catch(n){return console.warn("Scam-Protector: Failed to get scores",n),e}}async function c(){let o=S();if(o.length===0)return;let t=await v(o);E(t)}function L(o,t){let e=!1;return function(...s){e||(o.apply(this,s),e=!0,setTimeout(()=>{e=!1},t))}}function P(){let o=L(c,1e3);new MutationObserver(e=>{let s=!1;for(let n of e){if(n.type==="childList"||n.type==="attributes"){if(n.type==="attributes"&&n.attributeName==="href"){s=!0;break}if(n.addedNodes.length>0)for(let r=0;r<n.addedNodes.length;r++){let a=n.addedNodes[r];if(a.nodeType===Node.ELEMENT_NODE){let u=a;if(u.tagName==="A"||u.querySelector("a")){s=!0;break}}}}if(s)break}s&&("requestIdleCallback"in window?window.requestIdleCallback(()=>o()):setTimeout(()=>o(),100))}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["href"]})}async function A(){try{let o=await chrome.storage.sync.get("accessibility");if(o.accessibility&&Object.assign(i,o.accessibility),i.largeText){let t=document.createElement("style");t.textContent=`
        .sp-danger::before {
          font-size: 18px !important;
          padding: 10px 14px !important;
        }
      `,document.head.appendChild(t)}}catch(o){console.warn("Scam-Protector: Could not load accessibility settings")}}document.addEventListener("DOMContentLoaded",()=>{A().then(()=>{c(),P(),setTimeout(T,1e3)})});window.addEventListener("load",()=>{setTimeout(c,1e3)});})();
