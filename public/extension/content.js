"use strict";(()=>{var f=Object.defineProperty;var m=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var h=(r,t,e)=>t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,d=(r,t)=>{for(var e in t||={})g.call(t,e)&&h(r,e,t[e]);if(m)for(var e of m(t))y.call(t,e)&&h(r,e,t[e]);return r};var u=new Map,b=15*60*1e3,w=60,p=30,i={largeText:!0,highContrast:!1,verboseWarnings:!0,animationReduced:!1};function S(){let r=document.querySelectorAll("a[href]"),t=new Set;return r.forEach(e=>{try{let s=e.getAttribute("href");if(!s)return;if(s.startsWith("http://")||s.startsWith("https://")){let n=new URL(s);t.add(n.hostname)}}catch(s){}}),Array.from(t)}function C(r){return i.verboseWarnings?r<p?"\u26A0\uFE0F WARNING: This website appears to be unsafe! High risk of scam or fraud. Avoid clicking.":"\u26A0\uFE0F CAUTION: This website has a low trust score and might be unsafe. Click with caution.":"\u26A0\uFE0F Potential scam: low trust score"}function x(r){let t=100-r,e=document.createElement("div");e.className="sp-risk-meter";let s=document.createElement("div");s.className="sp-risk-meter-fill",s.style.setProperty("--risk-level",`${t}%`);let n=document.createElement("div");n.className="sp-risk-meter-marker",n.style.left="40%";let o=document.createElement("div");return o.className="sp-risk-meter-value",o.textContent=`Score: ${r}/100`,o.style.left=`${100-t}%`,e.appendChild(s),e.appendChild(n),e.appendChild(o),e}async function v(){try{u.clear(),await chrome.runtime.sendMessage({action:"getScores",clearCache:!0}),console.log("[Scam-Protector] Cache cleared successfully"),await c()}catch(r){console.error("[Scam-Protector] Failed to clear cache:",r)}}function E(){if(!(window.location.search.includes("sp-debug")||window.location.hostname==="localhost"||window.location.hostname.includes("test")))return;let t=document.createElement("div");t.style.position="fixed",t.style.bottom="10px",t.style.right="10px",t.style.padding="10px",t.style.background="rgba(0,0,0,0.8)",t.style.color="white",t.style.borderRadius="5px",t.style.zIndex="9999999",t.style.fontSize="12px",t.style.fontFamily="Arial, sans-serif";let e=document.createElement("button");e.textContent="Clear Score Cache",e.style.background="#ff3333",e.style.border="none",e.style.color="white",e.style.padding="5px 10px",e.style.borderRadius="3px",e.style.cursor="pointer",e.addEventListener("click",v);let s=document.createElement("button");s.textContent="Force Re-scan",s.style.background="#3333ff",s.style.border="none",s.style.color="white",s.style.padding="5px 10px",s.style.marginLeft="5px",s.style.borderRadius="3px",s.style.cursor="pointer",s.addEventListener("click",()=>c());let n=document.createElement("div");n.textContent="Scam-Protector debug mode",n.style.marginTop="5px",n.style.fontSize="10px",t.appendChild(e),t.appendChild(s),t.appendChild(n),document.body.appendChild(t)}function T(r){document.querySelectorAll("a[href]").forEach(e=>{try{let s=e.getAttribute("href");if(!s)return;if(s.startsWith("http://")||s.startsWith("https://")){let n=new URL(s),o=r[n.hostname];if(o!==void 0&&(console.debug(`Scam-Protector: ${n.hostname} has score ${o}`),o<w)){e.classList.add("sp-danger");let a=C(o);e.setAttribute("data-sp-warning",a),e.setAttribute("data-sp-score",o.toString()),e.setAttribute("aria-description",a);let l=x(o);e.appendChild(l),o<p&&e.classList.add("sp-danger-badge"),i.largeText&&e.style.setProperty("--sp-warning-font-size","16px"),i.highContrast&&e.classList.add("sp-high-contrast"),i.animationReduced&&e.style.setProperty("--sp-animation","none")}}}catch(s){}})}async function k(r){let t=Date.now(),e={},s=[];if(r.forEach(n=>{let o=u.get(n);o&&t-o.timestamp<b?e[n]=o.score:s.push(n)}),s.length===0)return e;try{let n=await chrome.runtime.sendMessage({action:"getScores",hosts:s});return Object.entries(n).forEach(([o,a])=>{u.set(o,{score:a,timestamp:t})}),d(d({},e),n)}catch(n){return console.warn("Scam-Protector: Failed to get scores",n),e}}async function c(){let r=S();if(r.length===0)return;let t=await k(r);T(t)}function L(r,t){let e=!1;return function(...s){e||(r.apply(this,s),e=!0,setTimeout(()=>{e=!1},t))}}function M(){let r=L(c,1e3);new MutationObserver(e=>{let s=!1;for(let n of e){if(n.type==="childList"||n.type==="attributes"){if(n.type==="attributes"&&n.attributeName==="href"){s=!0;break}if(n.addedNodes.length>0)for(let o=0;o<n.addedNodes.length;o++){let a=n.addedNodes[o];if(a.nodeType===Node.ELEMENT_NODE){let l=a;if(l.tagName==="A"||l.querySelector("a")){s=!0;break}}}}if(s)break}s&&("requestIdleCallback"in window?window.requestIdleCallback(()=>r()):setTimeout(()=>r(),100))}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["href"]})}async function P(){try{let r=await chrome.storage.sync.get("accessibility");if(r.accessibility&&Object.assign(i,r.accessibility),i.largeText){let t=document.createElement("style");t.textContent=`
        .sp-danger::before {
          font-size: 18px !important;
          padding: 10px 14px !important;
        }
      `,document.head.appendChild(t)}}catch(r){console.warn("Scam-Protector: Could not load accessibility settings")}}document.addEventListener("DOMContentLoaded",()=>{P().then(()=>{c(),M(),setTimeout(E,1e3)})});window.addEventListener("load",()=>{setTimeout(c,1e3)});})();
