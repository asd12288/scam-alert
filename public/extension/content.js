"use strict";(()=>{var v=Object.defineProperty;var g=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var y=(n,s,e)=>s in n?v(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e,p=(n,s)=>{for(var e in s||={})x.call(s,e)&&y(n,e,s[e]);if(g)for(var e of g(s))E.call(s,e)&&y(n,e,s[e]);return n};var f=new Map,C=15*60*1e3,T=60,m=30,h=40,d={largeText:!0,highContrast:!1,verboseWarnings:!0,animationReduced:!1},l={enabled:!0,autoHide:!1,autoHideDelay:1e4,showOnAllPages:!1,alwaysShowScore:!0};function L(){let n=document.querySelectorAll("a[href]"),s=new Set;return n.forEach(e=>{try{let t=e.getAttribute("href");if(!t)return;if(t.startsWith("http://")||t.startsWith("https://")){let r=new URL(t);s.add(r.hostname)}}catch(t){}}),Array.from(s)}function k(n){return d.verboseWarnings?n<m?"\u26A0\uFE0F WARNING: This website appears to be unsafe! High risk of scam or fraud. Avoid clicking.":"\u26A0\uFE0F CAUTION: This website has a low trust score and might be unsafe. Click with caution.":"\u26A0\uFE0F Potential scam: low trust score"}function P(n){let s=100-n,e=document.createElement("div");e.className="sp-risk-meter";let t=document.createElement("div");t.className="sp-risk-meter-fill",t.style.setProperty("--risk-level",`${s}%`),n<20?t.classList.add("sp-risk-meter-fill-extreme"):n<40?t.classList.add("sp-risk-meter-fill-high"):n<60?t.classList.add("sp-risk-meter-fill-medium"):t.classList.add("sp-risk-meter-fill-low");let r=document.createElement("div");return r.className="sp-risk-meter-value",r.textContent=`${n}/100`,r.style.left=`${100-s}%`,e.appendChild(t),e.appendChild(r),e}function b(n,s){if(!l.enabled)return;if(!l.showOnAllPages){let a=window.location.pathname;if(a!=="/"&&a!=="")return}let e=document.querySelector(".sp-safety-banner");if(e&&e.remove(),s>=h)return;let t=document.createElement("div");t.className="sp-safety-banner",s<m?t.classList.add("high-risk"):t.classList.add("medium-risk");let r=s<m?"HIGH RISK":"CAUTION",o=s<m?`This website (${n}) has been flagged as potentially unsafe with a very low security score.`:`This website (${n}) has a low security score and might be risky to use.`;t.innerHTML=`
    <div class="sp-safety-banner-content">
      <span class="sp-safety-banner-warning-icon">\u26A0\uFE0F</span>
      <span class="sp-safety-banner-text">
        <strong>${r}:</strong> ${o}
      </span>
      ${l.alwaysShowScore?`<div class="sp-safety-banner-score">
          Score: <span class="sp-safety-banner-score-value">${s}</span>
        </div>`:""}
      <button class="sp-safety-banner-action" id="sp-check-site">Check Details</button>
    </div>
    <button class="sp-safety-banner-close" id="sp-close-banner">\xD7</button>
  `,document.body.appendChild(t),setTimeout(()=>{t.classList.add("show")},500);let i=document.getElementById("sp-close-banner");i&&i.addEventListener("click",()=>{t.classList.remove("show"),setTimeout(()=>{t.remove()},300);try{let a=JSON.parse(localStorage.getItem("sp-dismissed-banners")||"{}");a[n]=Date.now(),localStorage.setItem("sp-dismissed-banners",JSON.stringify(a))}catch(a){console.error("Failed to store banner dismissal:",a)}});let c=document.getElementById("sp-check-site");c&&c.addEventListener("click",()=>{window.open(`https://scam-protector.com?domain=${encodeURIComponent(n)}`,"_blank")}),l.autoHide&&setTimeout(()=>{t.parentElement&&(t.classList.remove("show"),setTimeout(()=>{t.remove()},300))},l.autoHideDelay)}async function H(){let n=window.location.hostname;if(n){try{let e=JSON.parse(localStorage.getItem("sp-dismissed-banners")||"{}")[n];if(e&&Date.now()-e<60*60*1e3){console.debug(`[Scam-Protector] Banner for ${n} was recently dismissed, not showing again.`);return}}catch(s){}try{let e=(await w([n]))[n];e!==void 0&&e<h&&(console.debug(`[Scam-Protector] Creating safety banner for ${n} with score ${e}`),b(n,e))}catch(s){console.error("[Scam-Protector] Error checking current page safety:",s)}}}async function A(){try{f.clear(),await chrome.runtime.sendMessage({action:"getScores",clearCache:!0}),console.log("[Scam-Protector] Cache cleared successfully"),await u()}catch(n){console.error("[Scam-Protector] Failed to clear cache:",n)}}function N(){if(!(window.location.search.includes("sp-debug")||window.location.hostname==="localhost"||window.location.hostname.includes("test")))return;let s=document.createElement("div");s.style.position="fixed",s.style.bottom="10px",s.style.right="10px",s.style.padding="10px",s.style.background="rgba(0,0,0,0.8)",s.style.color="white",s.style.borderRadius="5px",s.style.zIndex="9999999",s.style.fontSize="12px",s.style.fontFamily="Arial, sans-serif";let e=document.createElement("button");e.textContent="Clear Score Cache",e.style.background="#ff3333",e.style.border="none",e.style.color="white",e.style.padding="5px 10px",e.style.borderRadius="3px",e.style.cursor="pointer",e.addEventListener("click",A);let t=document.createElement("button");t.textContent="Force Re-scan",t.style.background="#3333ff",t.style.border="none",t.style.color="white",t.style.padding="5px 10px",t.style.marginLeft="5px",t.style.borderRadius="3px",t.style.cursor="pointer",t.addEventListener("click",()=>u());let r=document.createElement("div");r.textContent="Scam-Protector debug mode",r.style.marginTop="5px",r.style.fontSize="10px",s.appendChild(e),s.appendChild(t),s.appendChild(r),document.body.appendChild(s)}function I(n){document.querySelectorAll("a[href]").forEach(e=>{try{let t=e.getAttribute("href");if(!t)return;if(t.startsWith("http://")||t.startsWith("https://")){let r=new URL(t),o=n[r.hostname];if(o!==void 0&&(console.debug(`Scam-Protector: ${r.hostname} has score ${o}`),e.querySelectorAll(".sp-risk-meter").forEach(a=>a.remove()),e.querySelectorAll(".sp-indicator").forEach(a=>a.remove()),e.classList.remove("sp-danger-extreme","sp-danger-high","sp-danger-medium","sp-danger-low"),o<T)){e.style.position="relative",e.classList.add("sp-danger"),o<20?e.classList.add("sp-danger-extreme"):o<35?e.classList.add("sp-danger-high"):o<50?e.classList.add("sp-danger-medium"):e.classList.add("sp-danger-low");let a=k(o);e.setAttribute("data-sp-warning",a),e.setAttribute("data-sp-score",o.toString()),e.setAttribute("aria-description",a);let S=P(o);e.style.marginBottom="16px",e.appendChild(S),d.largeText&&e.style.setProperty("--sp-warning-font-size","14px"),d.highContrast&&e.classList.add("sp-high-contrast"),d.animationReduced&&e.style.setProperty("--sp-animation","none"),console.debug(`Scam-Protector: Added risk meter to ${r.hostname} with score ${o}`)}}}catch(t){console.error("Scam-Protector: Error marking risky link",t)}})}async function w(n){let s=Date.now(),e={},t=[];if(n.forEach(r=>{let o=f.get(r);o&&s-o.timestamp<C?e[r]=o.score:t.push(r)}),t.length===0)return e;try{let r=await chrome.runtime.sendMessage({action:"getScores",hosts:t});return Object.entries(r).forEach(([o,i])=>{f.set(o,{score:i,timestamp:s})}),p(p({},e),r)}catch(r){return console.warn("Scam-Protector: Failed to get scores",r),e}}async function u(){let n=L();if(n.length===0)return;let s=await w(n);I(s);let e=window.location.hostname;if(e&&s[e]!==void 0){let t=s[e];t<h&&(console.debug(`[Scam-Protector] Current page (${e}) has low score: ${t}`),b(e,t))}}function R(n,s){let e=!1;return function(...t){e||(n.apply(this,t),e=!0,setTimeout(()=>{e=!1},s))}}function M(){let n=R(u,1e3);new MutationObserver(e=>{let t=!1;for(let r of e){if(r.type==="childList"||r.type==="attributes"){if(r.type==="attributes"&&r.attributeName==="href"){t=!0;break}if(r.addedNodes.length>0)for(let o=0;o<r.addedNodes.length;o++){let i=r.addedNodes[o];if(i.nodeType===Node.ELEMENT_NODE){let c=i;if(c.tagName==="A"||c.querySelector("a")){t=!0;break}}}}if(t)break}t&&("requestIdleCallback"in window?window.requestIdleCallback(()=>n()):setTimeout(()=>n(),100))}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["href"]})}async function $(){try{let n=await chrome.storage.sync.get("accessibility");if(n.accessibility&&Object.assign(d,n.accessibility),d.largeText){let s=document.createElement("style");s.textContent=`
        .sp-danger::before {
          font-size: 18px !important;
          padding: 10px 14px !important;
        }
      `,document.head.appendChild(s)}}catch(n){console.warn("Scam-Protector: Could not load accessibility settings")}}document.addEventListener("DOMContentLoaded",()=>{$().then(()=>{u(),M(),setTimeout(H,1e3),setTimeout(N,1e3)})});window.addEventListener("load",()=>{setTimeout(u,1e3)});})();
